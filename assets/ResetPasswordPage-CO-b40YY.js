import{r as c,u as k,j as e}from"./index-C39ZSvxf.js";const P="https://ssedsxqfinqnkwuejlxx.supabase.co",S="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzZWRzeHFmaW5xbmt3dWVqbHh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4Mjk1OTgsImV4cCI6MjA2ODQwNTU5OH0._RYdxDXBUkg_xwhiwdPxzKDhes8_A1WlSlTN_AmipZM";function z(){return new Promise((n,l)=>{var s;if((s=window.supabase)!=null&&s.createClient){n();return}const t=document.querySelector('script[data-supabase-js="true"]');if(t){t.addEventListener("load",()=>n(),{once:!0}),t.addEventListener("error",()=>l(new Error("Failed to load Supabase JS")),{once:!0});return}const r=document.createElement("script");r.src="https://unpkg.com/@supabase/supabase-js@2",r.async=!0,r.defer=!0,r.dataset.supabaseJs="true",r.onload=()=>n(),r.onerror=()=>l(new Error("Failed to load Supabase JS")),document.head.appendChild(r)})}async function F(){var n;if(!window.supabaseClient){if(await z(),!((n=window.supabase)!=null&&n.createClient))throw new Error("Supabase library not available");window.supabaseClient=window.supabase.createClient(P,S)}}function E(){const n=new URLSearchParams(window.location.hash.replace(/^#/,"")),l=new URLSearchParams(window.location.search),t=r=>n.get(r)||l.get(r);return{type:t("type"),access_token:t("access_token"),refresh_token:t("refresh_token"),error_code:t("error_code"),error_description:t("error_description")}}const _=()=>{const[n,l]=c.useState(!1),[t,r]=c.useState(!1),[s,w]=c.useState(""),[p,f]=c.useState(""),[h,g]=c.useState(!1),[u,m]=c.useState(null),j=k();c.useEffect(()=>{(async()=>{const{type:i,access_token:a,refresh_token:x,error_code:N,error_description:C}=E();if(N){m({type:"error",text:C||"The link is not valid or has expired."}),l(!0);return}if(!a||!x){m({type:"error",text:"Invalid or incomplete link. Please request a new recovery link."}),l(!0);return}try{await F();const d=window.supabaseClient;if(!d)throw new Error("Supabase client not available");const{error:y}=await d.auth.setSession({access_token:a,refresh_token:x});if(y)throw y;r(!0),m({type:"success",text:"Valid link. You can now change your password."})}catch(d){m({type:"error",text:(d==null?void 0:d.message)||"Could not validate the link. Please request a new one."})}finally{l(!0)}})()},[]);const o=(i,a)=>{m({type:i,text:a})},b=()=>s.length<8?(o("error","Password must be at least 8 characters long"),!1):/[A-Z]/.test(s)?/[a-z]/.test(s)?/[0-9]/.test(s)?s!==p?(o("error","Passwords do not match"),!1):!0:(o("error","Password must contain at least 1 number"),!1):(o("error","Password must contain at least 1 lowercase letter"),!1):(o("error","Password must contain at least 1 uppercase letter"),!1),v=async i=>{if(i.preventDefault(),!t){o("error","You must be authenticated to change your password.");return}if(b()){g(!0);try{const a=window.supabaseClient;if(!a)throw new Error("Supabase client not available");const{error:x}=await a.auth.updateUser({password:s});if(x)throw x;o("success","Password updated successfully! You can now sign in with your new password."),w(""),f("")}catch(a){o("error",(a==null?void 0:a.message)||"Unexpected error updating password.")}finally{g(!1)}}};return n?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-[#4FD1C5]/10",children:e.jsx("svg",{className:"h-8 w-8 text-[#4FD1C5]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Reset Password"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t?"Enter your new password to complete the process":"Link validation failed"})]}),u&&e.jsx("div",{className:`rounded-md p-4 ${u.type==="success"?"bg-green-50":"bg-red-50"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:u.type==="success"?e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:`text-sm font-medium ${u.type==="success"?"text-green-800":"text-red-800"}`,children:u.text})})]})}),t&&e.jsxs("form",{onSubmit:v,className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"New Password"}),e.jsx("div",{className:"mt-1 relative",children:e.jsx("input",{id:"password",name:"password",type:"password",required:!0,value:s,onChange:i=>w(i.target.value),className:"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-[#4FD1C5] focus:border-[#4FD1C5] focus:z-10 sm:text-sm",placeholder:"Enter your new password",minLength:8})}),e.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-md border border-gray-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-2",children:"Password requirements:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{className:`flex items-center text-xs ${s.length>=8?"text-green-600":"text-gray-500"}`,children:[e.jsx("span",{className:"mr-2",children:s.length>=8?"✓":"○"}),"At least 8 characters"]}),e.jsxs("li",{className:`flex items-center text-xs ${/[A-Z]/.test(s)?"text-green-600":"text-gray-500"}`,children:[e.jsx("span",{className:"mr-2",children:/[A-Z]/.test(s)?"✓":"○"}),"At least 1 uppercase letter"]}),e.jsxs("li",{className:`flex items-center text-xs ${/[a-z]/.test(s)?"text-green-600":"text-gray-500"}`,children:[e.jsx("span",{className:"mr-2",children:/[a-z]/.test(s)?"✓":"○"}),"At least 1 lowercase letter"]}),e.jsxs("li",{className:`flex items-center text-xs ${/[0-9]/.test(s)?"text-green-600":"text-gray-500"}`,children:[e.jsx("span",{className:"mr-2",children:/[0-9]/.test(s)?"✓":"○"}),"At least 1 number"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("div",{className:"mt-1 relative",children:e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:p,onChange:i=>f(i.target.value),className:`appearance-none relative block w-full px-3 py-2 border placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-[#4FD1C5] focus:border-[#4FD1C5] focus:z-10 sm:text-sm ${p&&s!==p?"border-red-500":"border-gray-300"}`,placeholder:"Confirm your new password",minLength:6})})]})]}),e.jsx("div",{children:e.jsxs("button",{type:"submit",disabled:h,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[#4FD1C5] hover:bg-[#4FD1C5]/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#4FD1C5] transition-colors duration-200 disabled:opacity-50",children:[e.jsx("span",{children:h?"Processing...":"Reset Password"}),h&&e.jsx("span",{className:"ml-2",children:e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Back to",e.jsx("button",{onClick:()=>j("/"),className:"font-medium text-[#4FD1C5] hover:text-[#4FD1C5]/80 ml-1",children:"Nutrimetrics"})]})})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"max-w-md w-full space-y-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-[#4FD1C5]/10",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-[#4FD1C5]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Loading..."}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Validating your reset link"})]})})})})};export{_ as default};
